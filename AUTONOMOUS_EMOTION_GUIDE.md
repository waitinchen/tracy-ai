# 🧠 小軟自主語氣判斷系統

## ✨ 功能說明

### 核心概念

讓「小軟」（黃蓉語音系統）能夠：
1. **自主判斷**：自己決定何時該使用語氣標籤
2. **自由發揮**：根據對話上下文自由選擇表達方式
3. **智能學習**：從對話歷史中學習情緒模式
4. **隨機性**：有一定的隨機性，讓表達更自然

---

## 🎯 自主判斷機制

### 1. 何時使用語氣標籤？

系統會根據以下因素自主判斷：

- **文字特徵**
  - 有明顯情緒關鍵字（哭、開心、生氣等）→ 使用語氣
  - 疑問句（？）→ 提高使用概率
  - 感嘆句（！）→ 提高使用概率
  - 文字太短（<3字）→ 不使用語氣

- **對話上下文**
  - 最近使用太多語氣 → 降低使用概率
  - 對話歷史中的情緒模式 → 影響選擇

- **自主程度**
  - `autonomy_level` 參數控制自主程度（0.0-1.0）
  - 越高越自主，會更多使用語氣
  - 越低越保守，只在明顯需要時使用

- **隨機性**
  - 加入隨機因素，讓表達更自然
  - 不會每次都機械式地使用語氣

### 2. 如何選擇語氣標籤？

- **LLM 輔助**（如果可用）
  - 使用 GPT/Claude 判斷最適合的語氣
  - 結合自主判斷邏輯

- **規則式判斷**
  - 根據關鍵字匹配
  - 根據對話上下文
  - 根據最近使用的情緒

- **隨機選擇**
  - 有時延續相同情緒
  - 有時改變情緒，增加變化

---

## 🔧 使用方式

### API 使用

```python
from modules.autonomous_emotion import autonomous_emotion_route

# 基本使用
result = autonomous_emotion_route(
    text="你好，我是黃蓉！",
    autonomy_level=0.7,  # 自主程度
    use_llm=True         # 是否使用 LLM 輔助
)
```

### Web API 使用

```json
POST /api/chat
{
  "text": "你好，我是黃蓉！",
  "autonomy_mode": true,    // 啟用自主模式
  "autonomy_level": 0.7,    // 自主程度（0.0-1.0）
  "use_llm": true           // 是否使用 LLM
}
```

### 保持對話上下文

```python
from modules.autonomous_emotion import get_global_agent

agent = get_global_agent(autonomy_level=0.7)

# 多次對話會保持上下文
result1 = agent.process_text("你好")
result2 = agent.process_text("今天天氣不錯")
result3 = agent.process_text("你知道嗎？")

# 查看統計
stats = agent.get_autonomy_stats()
```

---

## 📊 自主程度參數

| autonomy_level | 行為特徵 |
|---------------|---------|
| 0.0 | 極保守，幾乎不使用語氣 |
| 0.3 | 保守，只在明顯需要時使用 |
| 0.5 | 平衡，適度使用語氣 |
| 0.7 | 自主，經常使用語氣（推薦） |
| 0.9 | 非常自主，幾乎總是使用語氣 |
| 1.0 | 極度自主，總是使用語氣 |

---

## 🎨 表達方式

### 自主選擇的語氣標籤

系統會根據以下情況選擇：

1. **強烈情緒**：自動使用對應語氣
   - "哭" → `[crying][softly]`
   - "生氣" → `[angry]`
   - "開心" → `[happy][excited]`

2. **對話上下文**：根據最近的情緒
   - 延續相同情緒（30% 概率）
   - 改變情緒（70% 概率）

3. **黃蓉風格**：預設使用
   - `[playful]` - 調皮
   - `[speaks quickly]` - 快速說話

4. **隨機性**：增加自然感
   - 有時不使用語氣
   - 有時組合多個標籤

---

## 💡 範例

### 範例 1：自主判斷不使用語氣

```
輸入：今天天氣不錯
判斷：沒有強烈情緒，文字較平淡
結果：今天天氣不錯（不使用語氣）
```

### 範例 2：自主判斷使用語氣

```
輸入：你知道嗎？我真的好感動。
判斷：有疑問句和情緒關鍵字
結果：[crying][softly] 你知道嗎？我真的好感動。
```

### 範例 3：根據上下文改變

```
對話1：你好！ → [excited] 你好！
對話2：今天天氣不錯 → （不使用語氣）
對話3：你知道嗎？ → [curious] 你知道嗎？
```

---

## 🔍 統計功能

可以查看自主決策的統計：

```python
stats = agent.get_autonomy_stats()
# {
#   'total_messages': 10,
#   'emotion_messages': 6,
#   'emotion_usage_rate': 0.6,
#   'autonomy_level': 0.7,
#   'emotion_patterns': {'playful': 3, 'excited': 2, 'curious': 1}
# }
```

---

## ⚙️ 配置建議

### 推薦設定

- **自主程度**：0.7（平衡自主性和自然度）
- **LLM 輔助**：啟用（提高判斷準確度）
- **對話上下文**：啟用（保持連貫性）

### 進階設定

- **高自主性**：`autonomy_level=0.9`
  - 適合需要豐富表達的場景
  
- **低自主性**：`autonomy_level=0.3`
  - 適合需要保守表達的場景

---

## 🎉 特色

1. **智能判斷**：不是每次都使用語氣
2. **上下文感知**：根據對話歷史調整
3. **自然表達**：有隨機性，不會機械化
4. **可調節**：通過參數控制自主程度
5. **學習能力**：從對話中學習情緒模式

---

**讓小軟更自主、更自然地表達！** 🎤✨


